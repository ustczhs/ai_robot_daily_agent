{% extends "layout.html" %}

{% block title %}æœ€æ–°æ—¥æŠ¥æŠ¥å‘Š - AIä¸æœºå™¨äººæŠ€æœ¯æ—¥æŠ¥{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="card-title mb-0">
                    <i class="fas fa-newspaper me-2"></i>
                    {% if report_date != "æš‚æ— " and report_date != "é”™è¯¯" %}
                        {{ report_date }} æŠ€æœ¯æ—¥æŠ¥
                    {% else %}
                        AIä¸æœºå™¨äººæŠ€æœ¯æ—¥æŠ¥
                    {% endif %}
                </h4>
            </div>
            <div class="card-body">
                {% if content %}
                    <div class="report-content">
                        {{ content|safe }}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        æš‚æ— æŠ¥å‘Šå†…å®¹ï¼Œè¯·ç¨åæŸ¥çœ‹ã€‚
                    </div>
                {% endif %}
            </div>
            {% if report_date != "æš‚æ— " and report_date != "é”™è¯¯" %}
            <div class="card-footer text-muted">
                <small>
                    <i class="fas fa-clock me-1"></i>
                    æŠ¥å‘Šç”Ÿæˆæ—¶é—´: {{ report_date }} |
                    <i class="fas fa-sync me-1"></i>
                    é¡µé¢æ›´æ–°æ—¶é—´: {{ last_updated }}
                </small>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="col-lg-4">
        <!-- å¿«é€Ÿå¯¼èˆª -->
        <div class="card toc-card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>å¿«é€Ÿå¯¼èˆª
                </h5>
            </div>
            <div class="card-body">
                <div class="toc">
                    <p class="text-muted small mb-2">ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”ç« èŠ‚</p>
                    <ul id="toc-list">
                        <!-- ç›®å½•å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        <li><a href="#toc-æ¦‚è§ˆ">ğŸ“Š ä»Šæ—¥æ¦‚è§ˆ</a></li>
                        <li><a href="#toc-åˆ†ç±»">ğŸ”¥ æŠ€æœ¯åˆ†ç±»</a></li>
                        <li><a href="#toc-è¶‹åŠ¿">ğŸ“ˆ è¶‹åŠ¿åˆ†æ</a></li>
                        <li><a href="#toc-æ´å¯Ÿ">ğŸ”® å‰æ²¿æ´å¯Ÿ</a></li>
                        <li><a href="#toc-é¢„æµ‹">ğŸ¯ æ–¹å‘é¢„æµ‹</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿä¿¡æ¯ -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>ç³»ç»Ÿä¿¡æ¯
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>æŠ¥å‘Šæ—¥æœŸ:</strong> {{ report_date }}</p>
                <p class="mb-1"><strong>æ›´æ–°æ—¶é—´:</strong> {{ last_updated }}</p>
                <p class="mb-1"><strong>ç³»ç»ŸçŠ¶æ€:</strong> <span class="badge bg-success">æ­£å¸¸</span></p>
                <hr>
                <p class="mb-1"><strong>åŠŸèƒ½ç‰¹æ€§:</strong></p>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-check text-success me-1"></i> å®æ—¶æ–°é—»æ”¶é›†</li>
                    <li><i class="fas fa-check text-success me-1"></i> æ™ºèƒ½å†…å®¹åˆ†æ</li>
                    <li><i class="fas fa-check text-success me-1"></i> è‡ªåŠ¨åˆ†ç±»æ•´ç†</li>
                    <li><i class="fas fa-check text-success me-1"></i> è´¨é‡è¯„åˆ†è¯„ä¼°</li>
                </ul>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tools me-2"></i>å¿«æ·æ“ä½œ
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/reports" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-history me-1"></i>æŸ¥çœ‹å†å²æŠ¥å‘Š
                    </a>
                    <a href="/api/latest" class="btn btn-outline-info btn-sm" target="_blank">
                        <i class="fas fa-code me-1"></i>APIæ¥å£
                    </a>
                    <button class="btn btn-outline-secondary btn-sm" onclick="window.location.reload()">
                        <i class="fas fa-sync me-1"></i>åˆ·æ–°é¡µé¢
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ç”Ÿæˆç›®å½•å¯¼èˆª
document.addEventListener('DOMContentLoaded', function() {
    const tocList = document.getElementById('toc-list');
    const headers = document.querySelectorAll('.report-content h2, .report-content h3');

    if (headers.length > 0) {
        tocList.innerHTML = '';
        headers.forEach((header, index) => {
            const level = header.tagName.toLowerCase();
            const text = header.textContent.trim();
            const id = 'toc-' + text.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');

            // ä¸ºæ ‡é¢˜æ·»åŠ ID
            header.id = id;

            // æ·»åŠ åˆ°ç›®å½•
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = text;

            if (level === 'h3') {
                li.style.paddingLeft = '1rem';
                a.style.fontSize = '0.9em';
                a.style.color = '#6c757d';
            }

            // æ·»åŠ å›¾æ ‡
            const icon = document.createElement('i');
            if (text.includes('æ¦‚è§ˆ')) {
                icon.className = 'fas fa-chart-bar me-1';
            } else if (text.includes('åˆ†ç±»')) {
                icon.className = 'fas fa-tags me-1';
            } else if (text.includes('è¶‹åŠ¿')) {
                icon.className = 'fas fa-chart-line me-1';
            } else if (text.includes('æ´å¯Ÿ')) {
                icon.className = 'fas fa-lightbulb me-1';
            } else if (text.includes('é¢„æµ‹')) {
                icon.className = 'fas fa-crystal-ball me-1';
            } else {
                icon.className = 'fas fa-circle me-1';
                icon.style.fontSize = '0.5em';
            }

            a.insertBefore(icon, a.firstChild);
            li.appendChild(a);
            tocList.appendChild(li);
        });
    }

    // å¹³æ»‘æ»šåŠ¨
    document.querySelectorAll('.toc a').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}
